<!doctype html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HortiSystem ‚Äî Caixa</title>
    <style>
        :root {
          --accent: #16a34a;
          --accent2: #06b6d4;
          --danger: #dc2626;
          --text-muted: #6b7280;
          --bg: #f3f4f6;
        }

        * {
          box-sizing: border-box;
          font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
        }

        body {
          margin: 0;
          background: var(--bg);
          color: #111827;
          min-height: 100vh;
          display: flex;
          justify-content: center;
          align-items: flex-start;
          padding: 32px 16px;
        }

        .shell {
          width: 100%;
          max-width: 1200px;
          background: white;
          border-radius: 14px;
          box-shadow: 0 8px 30px rgba(0,0,0,0.08);
          overflow: hidden;
        }

        /* --- Header --- */
        .topbar {
          background: #111827;
          color: white;
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 18px 24px;
        }

        .brand {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .brand .logo {
         background: #065f46;
          color: white;
          font-weight: 700;
          padding: 10px 12px;
          border-radius: 8px;
        }

        nav a {
          color: #d1d5db;
          text-decoration: none;
          margin-left: 16px;
          font-weight: 500;
        }

        nav a:hover {
          color: white;
        }

        /* --- Layout --- */
        .layout {
          display: grid;
          grid-template-columns: 1fr 420px;
          gap: 20px;
          padding: 24px;
        }

        @media (max-width: 980px) {
          .layout {
            grid-template-columns: 1fr;
          }
        }

        /* --- Cards --- */
        .card {
          background: #f9fafb;
          border-radius: 12px;
          padding: 20px;
          border: 1px solid #e5e7eb;
          box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .card h3 {
          margin-top: 0;
          color: #111827;
        }

        .muted {
          color: var(--text-muted);
          font-size: 0.9rem;
        }

        label {
          display: block;
          margin-top: 10px;
          margin-bottom: 4px;
          font-weight: 600;
          color: var(--text-muted);
        }

        input[type=text],
        input[type=number] {
          width: 100%;
          padding: 10px;
          border-radius: 8px;
          border: 1px solid #d1d5db;
          background: white;
          color: #111827;
        }

        input:focus {
          outline: none;
          border-color: var(--accent);
          box-shadow: 0 0 0 2px #bbf7d0;
        }

        .btn {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
          padding: 10px 14px;
          border-radius: 8px;
          font-weight: 700;
          cursor: pointer;
          border: none;
          transition: all 0.2s;
        }

        .btn-primary {
          background: linear-gradient(90deg, var(--accent), var(--accent2));
          color: white;
        }

        .btn-primary:hover {
          opacity: 0.9;
        }

        .produtos-ref {
          margin-top: 16px;
          background: #f1f5f9;
          padding: 12px;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .prod-item {
          display: flex;
          justify-content: space-between;
          padding: 6px 0;
          border-bottom: 1px dashed #e5e7eb;
          font-size: 0.95rem;
        }

        /* --- Display (lado direito) --- */
        .display {
          background: #111827;
          color: #e5e7eb;
          font-family: monospace;
          border-radius: 12px;
          padding: 18px;
        }

        .display-line {
          border-bottom: 1px solid rgba(255,255,255,0.1);
          padding: 6px 0;
        }

        .total {
          font-size: 1.3rem;
          font-weight: 700;
          text-align: right;
          margin-top: 10px;
          color: #4ade80;
        }

        .payment-option {
          padding: 10px;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          cursor: pointer;
        }

        .payment-option.selecionado {
          background: linear-gradient(90deg, var(--accent), var(--accent2));
          color: white;
        }

        footer {
          background: #f9fafb;
          color: var(--text-muted);
          font-size: 0.85rem;
          text-align: center;
          padding: 14px;
          border-top: 1px solid #e5e7eb;
        }

        .menu {
          margin-top: 10px;
          text-align: center;
          border-top: 1px solid #e5e7eb;
          padding-top: 10px;
        }

        .menu a {
          color: var(--text-muted);
          text-decoration: none;
          margin: 0 10px;
          font-size: 0.9rem;
        }

        .menu a:hover {
          color: #111827;
        }
    </style>
</head>
<body>
<div class="shell">
    <header class="topbar">
        <div class="brand">
            <div class="logo">HS</div>
            <div style="font-weight:800">HortiSystem ‚Äî Caixa</div>
        </div>
        <nav>
            <a th:href="@{/}">üè† In√≠cio</a>
            <a th:href="@{/produto/lista}">üì¶ Produtos</a>
            <a th:href="@{/usuario/lista}">üë• Usu√°rios</a>
            <a th:href="@{/caixa}">üí∞ Caixa</a>
        </nav>
    </header>

    <div class="layout">
        <!-- √Årea principal -->
        <section class="card">
            <h3>üì¶ Leitor / C√≥digo</h3>
            <p class="muted">Digite o c√≥digo do produto e a quantidade</p>

            <form th:action="@{/caixa/adicionar}" method="post" style="margin-top:12px">
                <label for="codigoProduto">C√≥digo do Produto</label>
                <input type="text" id="codigoProduto" name="codigoProduto" required placeholder="Ex: 1, 2, 3..." autofocus>

                <label for="quantidade">Quantidade</label>
                <input type="number" id="quantidade" name="quantidade" value="1" min="1" required>

                <button class="btn btn-primary" type="submit">‚ûï Adicionar</button>
            </form>

            <div class="produtos-ref">
                <h4>üìã Produtos Cadastrados</h4>
                <div th:each="produto : ${produtos}" class="prod-item">
                    <div><strong th:text="'C√≥d: ' + ${produto.id}"></strong> ‚Äî <span th:text="${produto.nome}"></span></div>
                    <div th:text="${#numbers.formatDecimal(produto.valor, 1, 2, 'POINT')}">0.00</div>
                </div>
            </div>
        </section>

        <!-- Display do caixa -->
        <aside class="display">
            <h3>üñ•Ô∏è Display do Caixa</h3>
            <div class="display-line"><strong>HORTISYSTEM SUPERMERCADO</strong></div>
            <div class="display-line">
                Data: <span th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}"></span>
            </div>

            <div class="display-line" th:if="${novoItem}">
                <strong>√öLTIMO ITEM:</strong>
                <div th:text="${novoItem.produto.nome}"></div>
                <div th:text="'Qtd: ' + ${novoItem.quantidade} + ' x R$ ' + ${#numbers.formatDecimal(novoItem.valorUnitario, 1, 2, 'POINT')}"></div>
                <div th:text="'Subtotal: R$ ' + ${#numbers.formatDecimal(novoItem.subtotal, 1, 2, 'POINT')}"></div>
            </div>

            <div class="total">TOTAL: R$ <span th:text="${#numbers.formatDecimal(venda.valorTotal, 1, 2, 'POINT')}">0.00</span></div>

            <form th:action="@{/caixa/finalizar}" method="post" th:object="${venda}" style="margin-top:16px">
                <label for="nomeCliente">Nome do Cliente (Opcional)</label>
                <input type="text" id="nomeCliente" th:field="*{nomeCliente}" placeholder="Consumidor">

                <label for="valorRecebido">Valor Recebido (R$)</label>
                <input type="number" id="valorRecebido" th:field="*{valorRecebido}" step="0.01" min="0" placeholder="0.00">

                <input type="hidden" id="formaPagamento" th:field="*{formaPagamento}">
                <button type="submit" class="btn btn-primary">‚úÖ Finalizar Venda</button>
            </form>
        </aside>
    </div>

    <div class="menu">
        <a th:href="@{/usuario/lista}">üë• Usu√°rios</a>
        <a th:href="@{/produto/lista}">üì¶ Produtos</a>
        <a th:href="@{/}">üè† In√≠cio</a>
    </div>

    <footer>
        ¬© <span th:text="${T(java.time.Year).now()}"/> HortiSystem
    </footer>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const codigo = document.getElementById('codigoProduto');
        if (codigo) codigo.focus();
    });
</script>
</body>
</html>
