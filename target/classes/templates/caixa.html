<!doctype html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HortiSystem ‚Äî Caixa</title>
    <style>
        :root{--bg:#0f1724;--panel:#0b1220;--muted:#98a0ad;--accent-1:#22c55e;--accent-2:#06b6d4;--card:#0b1220;--radius:12px}
        *{box-sizing:border-box}
        body{margin:0;font-family:Inter, system-ui, monospace;background:var(--bg);color:#e6eef6;min-height:100vh;padding:24px}
        .shell{max-width:1100px;margin:0 auto}
        .topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-radius:12px;margin-bottom:18px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
        .brand{display:flex;gap:12px;align-items:center}
        .brand .logo{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));display:flex;align-items:center;justify-content:center}
        .layout{display:grid;grid-template-columns:1fr 420px;gap:18px}
        .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
        .scanner{padding:16px;border-radius:10px;background:rgba(255,255,255,0.02)}
        label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
        input[type=text],input[type=number]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
        .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
        .btn-primary{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#022}
        .display{font-family:monospace;color:#9ef29a;background:#021312;padding:14px;border-radius:10px}
        .display h3{margin:0 0 8px}
        .display-line{border-bottom:1px solid rgba(255,255,255,0.02);padding:8px 0}
        .total{font-size:22px;font-weight:800;text-align:right}
        .produtos-ref{margin-top:12px;background:rgba(255,255,255,0.02);padding:12px;border-radius:8px}
        .prod-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.02)}
        .payment-actions{display:flex;gap:8px;margin-top:12px}
        .payment-option{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
        .payment-option.selecionado{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#022}
        footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}
        @media(max-width:980px){.layout{grid-template-columns:1fr}.shell{padding:12px}}
    </style>
</head>
<body>
<div class="shell">
    <header class="topbar">
        <div class="brand"><div class="logo">HS</div><div style="font-weight:800">HortiSystem ‚Äî Caixa</div></div>
        <nav style="display:flex;gap:8px"><a href="/" style="color:var(--muted);text-decoration:none">üè† In√≠cio</a><a href="/vendas" style="color:var(--muted);text-decoration:none">üí∞ Vendas</a></nav>
    </header>

    <div class="layout">
        <section class="card">
            <div class="scanner">
                <h3>üì¶ Leitor / C√≥digo</h3>
                <p style="color:var(--muted)">Digite o c√≥digo do produto e a quantidade</p>

                <form th:action="@{/caixa/adicionar}" method="post" style="margin-top:12px">
                    <div style="margin-bottom:10px">
                        <label for="codigoProduto">C√≥digo do Produto</label>
                        <input type="text" id="codigoProduto" name="codigoProduto" required placeholder="Ex: 1, 2, 3..." autofocus>
                    </div>
                    <div style="margin-bottom:10px">
                        <label for="quantidade">Quantidade</label>
                        <input type="number" id="quantidade" name="quantidade" value="1" min="1" required>
                    </div>
                    <button class="btn btn-primary" type="submit">‚ûï ADICIONAR</button>
                </form>

                <div class="produtos-ref">
                    <h4 style="margin:0 0 8px">üìã Produtos Cadastrados</h4>
                    <div th:each="produto : ${produtos}" class="prod-item">
                        <div><strong th:text="'C√≥d: ' + ${produto.id}"></strong> - <span th:text="${produto.nome}"></span></div>
                        <div th:text="${#numbers.formatDecimal(produto.valor, 1, 2, 'POINT')}">0.00</div>
                    </div>
                </div>
            </div>
        </section>

        <aside class="card display">
            <h3>üñ•Ô∏è Display do Caixa</h3>
            <div class="display-line"><strong>HORTISYSTEM SUPERMERCADO</strong></div>
            <div class="display-line">Data: <span th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}"></span></div>

            <div class="display-line" th:if="${novoItem}">
                <strong>√öLTIMO ITEM:</strong>
                <div th:text="${novoItem.produto.nome}"></div>
                <div th:text="'Qtd: ' + ${novoItem.quantidade} + ' x R$ ' + ${#numbers.formatDecimal(novoItem.valorUnitario, 1, 2, 'POINT')}"></div>
                <div th:text="'Subtotal: R$ ' + ${#numbers.formatDecimal(novoItem.subtotal, 1, 2, 'POINT')}"></div>
            </div>

            <div class="total">TOTAL: R$ <span th:text="${#numbers.formatDecimal(venda.valorTotal, 1, 2, 'POINT')}">0.00</span></div>

            <div style="margin-top:12px">
                <form th:action="@{/caixa/finalizar}" method="post" th:object="${venda}">
                    <label for="nomeCliente">Nome do Cliente (Opcional)</label>
                    <input type="text" id="nomeCliente" th:field="*{nomeCliente}" placeholder="Consumidor" style="margin-bottom:8px">

                    <label for="valorRecebido">Valor Recebido (R$)</label>
                    <input type="number" id="valorRecebido" th:field="*{valorRecebido}" step="0.01" min="0" placeholder="0.00" style="margin-bottom:8px">

                    <div style="display:flex;gap:8px;flex-wrap:wrap">
                        <input type="hidden" id="formaPagamento" th:field="*{formaPagamento}">
                        <button type="submit" class="btn btn-primary">‚úÖ Finalizar Venda</button>
                        <a href="#" class="btn" style="background:transparent;color:var(--muted);border-radius:10px;padding:10px 12px">‚ùå Cancelar</a>
                    </div>
                </form>
            </div>

        </aside>
    </div>

    <footer style="margin-top:14px;text-align:center;color:var(--muted)">¬© <span th:text="${T(java.time.Year).now()}"/> HortiSystem</footer>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function(){ var codigo = document.getElementById('codigoProduto'); if(codigo) codigo.focus(); });
</script>
</body>
</html>
